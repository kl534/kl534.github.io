<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Youth Baseball Lineup Generator</title>
    <style>
        /* Previous styles remain the same */
        .player-input button.remove {
            background-color: #ff4444;
            padding: 5px 10px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="roster-input">
        <h2>Team Roster (Players 12-24)</h2>
        <div id="playerInputs">
            <!-- Player inputs will be generated here -->
        </div>
        <button onclick="generateLineup()">Generate Lineup</button>
    </div>

    <div id="results" class="results" style="display: none;">
        <h2>Game Lineups</h2>
        <div id="inningsOutput"></div>
    </div>

    <script>
        const positions = ['P', 'C', '1B', '2B', '3B', 'SS'];
        const outfieldPositions = ['LF', 'LCF', 'RCF', 'RF'];
        const playerInputs = document.getElementById('playerInputs');

        // Initialize 13 players with numbers 12-24 and remove buttons
        function initializePlayers() {
            playerInputs.innerHTML = '';
            for (let i = 0; i < 13; i++) {
                const div = document.createElement('div');
                div.className = 'player-input';
                div.innerHTML = `
                    <input type="text" value="${12 + i}" readonly>
                    <select>
                        ${positions.map(pos => `<option value="${pos}">${pos}</option>`).join('')}
                    </select>
                    <select>
                        ${positions.map(pos => `<option value="${pos}">${pos}</option>`).join('')}
                    </select>
                    <button class="remove" onclick="this.parentElement.remove()">Remove</button>
                `;
                playerInputs.appendChild(div);
            }
        }

        function generateLineup() {
            const players = [];
            const inputs = document.querySelectorAll('.player-input');
            
            // Collect player data
            inputs.forEach((input, index) => {
                const name = input.children[0].value.trim();
                const pref1 = input.children[1].value;
                const pref2 = input.children[2].value;
                
                players.push({
                    name,
                    preferences: [pref1, pref2],
                    stats: {
                        positions: {},
                        sit: 0,
                        lastSatInning: -1
                    }
                });
            });

            const playerCount = players.length;
            if (playerCount < 10) {
                alert('Minimum 10 players required');
                return;
            }

            const sitsPerInning = playerCount - 10;
            const maxCooldown = Math.max(1, Math.floor(6 / sitsPerInning));

            // Initialize stats
            players.forEach(player => {
                [...positions, ...outfieldPositions].forEach(pos => {
                    player.stats.positions[pos] = 0;
                });
                player.stats.sit = 0;
                player.stats.lastSatInning = -1;
            });

            const innings = [];
            
            // Generate 6 innings
            for (let inningNum = 1; inningNum <= 6; inningNum++) {
                let sitting = [];
                let cooldown = maxCooldown;
                let retries = 3;

                while (sitting.length < sitsPerInning && retries > 0) {
                    const candidates = players
                        .filter(p => !sitting.includes(p))
                        .filter(p => p.stats.lastSatInning === -1 || 
                                   inningNum - p.stats.lastSatInning > cooldown)
                        .sort((a, b) => a.stats.sit - b.stats.sit || 
                                      a.stats.lastSatInning - b.stats.lastSatInning);

                    const needed = sitsPerInning - sitting.length;
                    sitting.push(...shuffleArray(candidates).slice(0, needed));
                    
                    if (sitting.length < sitsPerInning) {
                        cooldown = Math.max(0, cooldown - 1);
                        retries--;
                    }
                }

                // Fallback - select least sat players
                if (sitting.length < sitsPerInning) {
                    const needed = sitsPerInning - sitting.length;
                    const remaining = players
                        .filter(p => !sitting.includes(p))
                        .sort((a, b) => a.stats.sit - b.stats.sit);
                    sitting.push(...remaining.slice(0, needed));
                }

                // Update sitting stats
                sitting.forEach(p => {
                    p.stats.sit++;
                    p.stats.lastSatInning = inningNum;
                });

                // Assign positions
                const assignments = {};
                const playing = players.filter(p => !sitting.includes(p));
                const infieldPositions = shuffleArray([...positions]);

                // Assign infield positions
                infieldPositions.forEach(pos => {
                    const candidate = playing.find(p => 
                        p.preferences.includes(pos) && 
                        !Object.values(assignments).includes(p.name)
                    ) || playing.find(p => !Object.values(assignments).includes(p.name));
                    
                    if (candidate) {
                        assignments[pos] = candidate.name;
                        candidate.stats.positions[pos]++;
                    }
                });

                // Assign outfield positions
                let ofIndex = 0;
                playing.forEach(player => {
                    if (!Object.values(assignments).includes(player.name)) {
                        const pos = outfieldPositions[ofIndex];
                        assignments[pos] = player.name;
                        player.stats.positions[pos]++;
                        ofIndex++;
                    }
                });

                innings.push({
                    inning: inningNum,
                    sitting: sitting.map(p => p.name),
                    assignments: {...assignments}
                });
            }

            displayResults(innings);
        }

        function displayResults(innings) {
            const output = document.getElementById('inningsOutput');
            output.innerHTML = '';
            
            innings.forEach(inning => {
                const inningDiv = document.createElement('div');
                inningDiv.className = 'inning';
                inningDiv.innerHTML = `
                    <h3>Inning ${inning.inning}</h3>
                    <div class="positions">
                        <div class="position-group">
                            <h4>Infield</h4>
                            ${positions.map(pos => `
                                <div>${pos}: ${inning.assignments[pos] || 'UNASSIGNED'}</div>
                            `).join('')}
                        </div>
                        <div class="position-group">
                            <h4>Outfield</h4>
                            ${outfieldPositions.map(pos => `
                                <div>${pos}: ${inning.assignments[pos] || 'UNASSIGNED'}</div>
                            `).join('')}
                        </div>
                    </div>
                    <div><strong>Sitting Out:</strong> ${inning.sitting.join(', ')}</div>
                `;
                output.appendChild(inningDiv);
            });

            document.getElementById('results').style.display = 'block';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize players on load
        initializePlayers();
    </script>
</body>
</html>
